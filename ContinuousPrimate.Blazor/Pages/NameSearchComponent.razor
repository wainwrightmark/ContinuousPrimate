@using System.Collections.Concurrent
@inject HttpClient _httpClient;
@inject Blazored.LocalStorage.ILocalStorageService _localStorage
@inject IDialogService DialogService




<MudContainer MaxWidth="MaxWidth.Small" Style="padding-left: 0; padding-right: 0;">
    
    <MudToolBar>
        <MudTextField
            @ref="_searchField"
            @bind-Value="TextValue"
            Label="Search"
            HelperText="@HelperText"
            Variant="Variant.Text"
            Clearable="true" Disabled="@_isSearching"/>
        
        
        <MudIconButton
            OnClick="ShowSettings"
            Icon="@Icons.Filled.Settings"
            Title="Settings"
            />

        <MudIconButton
            Link="https://github.com/wainwrightmark/ContinuousPrimate"
            Icon="@Icons.Custom.Brands.GitHub"
            Title="View on Github"
            Target="_blank"/>

    </MudToolBar>

    

    @if (MyData is not null)
    {
        <MudSimpleTable Hover="true" Dense="true" Striped="true">

            <tbody>
            @foreach (var row in MyData.TableElements)
            {
                <tr>
                    <td>
                        @foreach (var word in @row.OriginalTerms)
                        {
                            <MudTooltip Arrow="true" Text="@word.Gloss">
                                <MudText>@word.Text </MudText>
                            </MudTooltip>
                            <MudElement> </MudElement>
                        }

                    </td>
                    <td>
                        @foreach (var word in @row.AnagramWords)
                        {
                            <MudTooltip Arrow="true" Text="@word.Gloss">
                                <MudText>@word.Text </MudText>
                            </MudTooltip>
                            <MudElement> </MudElement>
                        }
                    </td>

                    <td>

                        <MudMenu Icon="@Icons.Filled.Menu" Dense="true" AnchorOrigin="Origin.TopLeft" TransformOrigin="Origin.TopRight">
                            <MudMenuItem>
                                <MudIconButton
                                    Link="@SocialHelpers.GetFacebookShareURL(row)"
                                    Icon="@Icons.Custom.Brands.Facebook"
                                    Title="Share on Facebook"
                                    Target="_blank"/>
                            </MudMenuItem>

                            <MudMenuItem>
                                <MudIconButton
                                    Link="@SocialHelpers.GetTwitterShareUrl(row)"
                                    Icon="@Icons.Custom.Brands.Twitter"
                                    Title="Share on Twitter"
                                    Target="_blank"/>
                            </MudMenuItem>

                            <MudMenuItem>
                                <MudToggleIconButton
                                    Icon="@Icons.Filled.StarOutline"
                                    ToggledIcon="@Icons.Filled.Star"
                                    Title="Favourite"
                                    Toggled="@DatabaseWords.Contains(row)"
                                    ToggledChanged="b => SetFavourite(b, row)"/>
                            </MudMenuItem>
                        </MudMenu>

                    </td>
                </tr>
            }
            </tbody>

        </MudSimpleTable>
    }
    else
    {
        <MudSkeleton Style="margin-top: 50px" SkeletonType="SkeletonType.Rectangle" Width="100%" Height="450px"/>
    }


    <MudToolBar>
        
        <MudSpacer/>
        @if (MyData is not null)
        {
            <MudNumericField T="int"
                             @bind-Value="MyData.PageNumber"
                             Min="1"
                             FullWidth="false"
                             Style="Width: 60px;"
                             HideSpinButtons="true"
                             Adornment="Adornment.End"
                             AdornmentIcon="@Icons.Filled.NavigateNext"
                             Disabled="@(!MyData.CanIncreasePageNumber)"
                             OnAdornmentClick="() => MyData.PageNumber++"/>
        }
    </MudToolBar>

</MudContainer>